# Создание моков

| Аннтотация | Что делает |
| ------ | ------ |
| `@MockK` | Cоздает мок объекта |
| `@RelaxedMockK` | Cоздает мок объекта, методы возвращают моки своих значений|
| `@SpyK` | Cоздает мок объекта, копирует настоящего объекта |

Для создания моков отмеченных аннотациями необходимо вызвать `MockKAnnotations.init`

| Функция | Что делает |
| ------ | ------ |
| `mockkObject` | позволяет создать мок Enum или Object |
| `mockkConstructor` | позволяет создать мок конструктора объекта|
| `mockkClass` | позволяет создать мок класса. В отличие от `mockK`, принимает ссылку на класс |
| `mockkStatic` | позволяет создать мок функции расширения определенной на уровне модуля. Принимает ссылку на функцию или название модуля в специальном формате. При этом можно будет создавать моки для всех функций в модуле |
| `mockK` | позволяет создать мок класса. В отличие от `mockkClass`, принимает параметр типа |
| `spyk` | позволяет создать мок класса и скопировать поля настоящего объекта. |

`spyk` - создает мок копируя поля переданного объекта, либо создает объект используя вызов констуктора без аргументов.

Объект получаемый из `spykK`, `mockK` или `mockkClass` может так же реализовывать интерфейсы, ссылки на которые были переданы при создании мока.  

[Пример кода](https://github.com/vladimirlisovskij/mockk-abstract/blob/main/MockCreate.kt)

<br/>

---

# Настройка поведения моков

| Функция | Что делает |
| ------ | ------ |
| `every/coEvery` | позваоляет назначить желаемое поведение указанному моку  |
| `returns` | указывает возвращаемое значение - можно указать списком значения последовательных возвратов|
| `throws` | указывает возвращаемое исключение |
| `answers/coAnswers` | указывает блок кода для выполнения |

`constructedWith` - следует использовать для того, чтобы задать поведение мока объекта, созданного через указанный конструктор.

`anyConstructed` - следует использовать для того, чтобы задать поведение мока объекта, созданного через любой конструктор.

При использовании `spyK` - моков можно получить доступ к закрытым полям объекта. Для этого используются динамические вызовы.

[Пример кода](https://github.com/vladimirlisovskij/mockk-abstract/blob/main/MockBehavior.kt)

<br/>

---

# Проверка вызовов методов

| Функция | Что делает |
| ------ | ------ |
| `verify/coVerify` | проверка вызова метода |

В качестве параметров можно указать минимальное, максимальное или точное число вызовов, время ожидания выполнения проверки.

Так же можно указать тип проверки.

| Тип проверки | Важен порядок вызова методов? | Все вызовы объекта должны быть проверены? |
| ------ | ------ | ------ | 
| `UNORDERED` | нет | нет |
| `ORDERED` | да | нет |
| `ALL` | нет | да |
| `SEQUENCE` | да | да |

Так же существуют `verifyAll/coVerifyAll`, `verifyOrder/coverifyOrder`, `verifySequence/coverifySequence` осуществляющие аналогичные проверки.

Используя вызов `wasNot Called` можно проверить, что мок ни разу не вызывался.

Используя `excludeRecords` можно исключить вызовы из проверки.

`confirmVerified` - вызывает исключение если не все вызовы объекта были обработаны.


[Пример кода](https://github.com/vladimirlisovskij/mockk-abstract/blob/main/MethodCallsVerify.kt)

<br/>

---

# Работа с varargs

Для описания последовательностей значений в varargs используются:

| Функция | Что делает |
| ------ | ------ |
| `varargAll` | все значения в последовательности удовлетворяют условию |
| `varargAny` | некоторые значения в последовательности удовлетворяют условию |
| `anyVararg` | последовательность любых значений |

Существуют схожие функции для примитивов, например `anyBooleanVararg` или `varargAnyInt`.

[Пример кода](https://github.com/vladimirlisovskij/mockk-abstract/blob/main/Vararg.kt)

<br/>

---

# Валидация аргументов

Для валидации различных аргументов используются матчеры.
Несколько втроенных матчеров:

| Функция | Что делает |
| ------ | ------ |
| `any` | любое значение аргумента |
| `capture` | записывает переданные значения в slot |
| `eq` | точное совпадение аргумента |
| `match/coMatch` | проверка блоком кода |

Свой матчер можно создать реализовав интерфейс `Matcher` либо написав функцию расширения для `MockKVerificationScope` или `MockKMatcherScope`.

[Пример кода](https://github.com/vladimirlisovskij/mockk-abstract/blob/main/Matchers.kt)

<br/>

---

*`co`-префиксы используются для работы с корутинами*
